% if (not $wr or $wr->errstr) {
  <div class="container">
    <div class="error">
      <strong>Fehler bei der Abfrage der Wagenreihung:</strong>
      <%= $wr ? $wr->errstr : $wr_error %>
    </div>
  </div>
% }
% else {
  % my $has_multi_dest = 0;
  % my $has_multi_desc = 0;
  % if (scalar $wr->destinations > 1) {
    % $has_multi_dest = 1;
  % }
  % if (scalar $wr->train_descriptions > 1) {
    % $has_multi_desc = 1;
  % }
  <div class="container">
    <div style="text-align: center;">
      <%= $wr->station->{name} %> Gleis <%= $wr->platform %><br/>
    </div>
  </div>
  <div class="container">
    <div class="wagonorder exit-<%= stash('exit_dir') // 'unknown'%>">
%     if (not $wr->has_bad_wagons) {
%       for my $section ($wr->sections) {
          <div class="section" style="
          top: <%= $section->{start_percent} %>%; bottom: <%= 100 - $section->{end_percent} %>%;">
%=          $section->{name}
          </div>
%       }
%     }
%     my $gi;
%     for my $wagon ($wr->wagons) {
%=      include '_wagon', wr => $wr, wagon => $wagon, prev_gi => $gi, multi => $has_multi_desc + $has_multi_dest, wref => $wref, exit_dir => stash('exit_dir');
%       $gi = $wagon->group_index;
%     }
      </div>
      <div style="text-align: center;">
%=      join( ' / ', map { $_->{name} } $wr->origins )
        â†’
%=      join( ' / ', map { $_->{name} } $wr->destinations )
      </div>
    % for my $desc ($wr->train_descriptions) {
      % if ($desc->{text}) {
        <div style="text-align: center;">
          %= $desc->{text}
          % if ($has_multi_desc and length(join(q{}, sort @{$desc->{sections}}))) {
            in Abschnitt <%= join(q{}, sort @{$desc->{sections}}) %>
          % }
        </div>
      % }
    % }
<!--  <div>
      Legende: â™¿ Behindertengerechte Ausstattung / ğŸ´ Bistro/Restaurant / ğŸšª Abteile vorhanden
    </div>
-->
    <p class="copyright">
      Quelle: DB Wagenreihungs-API. Angaben ohne GewÃ¤hr.
    </p>

  </div>
% }
