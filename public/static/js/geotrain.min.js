$(function(){var e=function(){$("div.candidatestatus").remove()},t=function(e,t,n){var r=$(document.createElement("div"));r.attr("class","error"),r.text(t);var o=$(document.createElement("strong"));if(o.text(e),r.prepend(o),n){var i=$(document.createElement("div"));i.attr("class","errcode"),i.text(n),r.append(i)}$("div.candidatelist").append(r)},n=function(n){e(),n.error?t("Backend-Fehler:",n.error,null):0==n.evas.length?t("Keine Bahnstrecke gefunden","",null):0==n.trains.length?t("Keine Züge auf der Strecke gefunden","",null):$.each(n.trains,function(e,t){const n=t.stops[0][1],r=t.stops[0][2],o=t.stops[1][0],i=t.stops[1][1],a=t.stops[1][2];var d=$(document.createElement("a"));d.attr("href","/z/"+t.train+"/"+o),d.text(t.line);var c=$(document.createElement("div"));c.attr("class","traininfo"),c.html(t.likelihood+"%<br/>"+r+" "+n+"<br/>"+a+" "+i),d.append(c),$("div.candidatelist").append(d)})},r=function(r){$.get("https://dbf.finalrewind.org/__geotrain/search",{lon:r.coords.longitude,lat:r.coords.latitude},n).fail(function(n,r,o){e(),t("Fehler im Zuglokalisierungs-Backend: ",r,o)}),$("div.candidatestatus").text("Suche Züge…")},o=function(n){e(),n.code==n.PERMISSION_DENIED?t("Standortanfrage nicht möglich.","Vermutlich fehlen die Rechte im Browser oder der Android Location Service ist deaktiviert.","geolocation.error.PERMISSION_DENIED"):n.code==n.POSITION_UNAVAILABLE?t("Standort konnte nicht ermittelt werden","(Service nicht verfügbar)","geolocation.error.POSITION_UNAVAILABLE"):n.code==n.TIMEOUT?t("Standort konnte nicht ermittelt werden","(Timeout)","geolocation.error.TIMEOUT"):t("Standort konnte nicht ermittelt werden","(unbekannter Fehler)","unknown geolocation.error code")};navigator.geolocation?(navigator.geolocation.getCurrentPosition(r,o),$("div.candidatestatus").text("Position wird bestimmt…")):(e(),t("Standortanfragen werden von diesem Browser nicht unterstützt","",null))});
